---
title: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ
author: –î–∞–Ω—è –ú–µ—Ä–∫—É–ª–æ–≤
institute: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö! –¶–£
format:
    pdf:
        include-in-header: ../files/longread_header.tex
        keep-tex: true
number-sections: true
---


# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ

## {.plain}
![–ö–æ–≥–¥–∞ –≤—ã –ø–æ–Ω—è–ª–∏ –∏–¥–µ—é](autograd_expectations.jpeg){width=65%}

## {.plain}
![–≠—Ç–æ –Ω–µ autograd](avtograd.jpeg){width=45%}

## –ó–∞–¥–∞—á–∞

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º —Ä–µ—à–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É:

$$
L(w) \to \min_{w \in \mathbb{R}^d}
$$


* –¢–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –æ–±—ã—á–Ω–æ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –≤ –º–∞—à–∏–Ω–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏, –∫–æ–≥–¥–∞ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã $w$ –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—É—á–∏—Ç—å –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–µ—Ç—å). 
* –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏. –û–¥–Ω–∞–∫–æ, —É—á–∏—Ç—ã–≤–∞—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–¥–∞—á–∏, –≥–¥–µ $d$ –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏–≥–∞—Ç—å –¥–µ—Å—è—Ç–∫–æ–≤ –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤, —ç—Ç–æ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å –±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É—è –∞–ª–≥–æ—Ä–∏—Ç–º—ã –Ω—É–ª–µ–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞. 
* –ü–æ—ç—Ç–æ–º—É –±—ã–ª–æ –±—ã –ø–æ–ª–µ–∑–Ω–æ —É–º–µ—Ç—å –≤—ã—á–∏—Å–ª—è—Ç—å –≤–µ–∫—Ç–æ—Ä –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ $\nabla_w L = \left( \frac{\partial L}{\partial w_1}, \ldots, \frac{\partial L}{\partial w_d}\right)^T$. 
* –û–±—ã—á–Ω–æ –ø–µ—Ä–≤—ã–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ –≤ –±–æ–ª—å—à–∏—Ö –∑–∞–¥–∞—á–∞—Ö, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –≤—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã —Ç—Ä–µ–±—É—é—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏.

## –ü—Ä–∏–º–µ—Ä: –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –º–∞—Ç—Ä–∏—Ü–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –¥–ª—è $N$ $d$-–º–µ—Ä–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ $D \in \mathbb{R}^{N \times N}$. –£—á–∏—Ç—ã–≤–∞—è —ç—Ç—É –º–∞—Ç—Ä–∏—Ü—É, –º—ã —Ö–æ—Ç–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã $W_i \in \mathbb{R}^d, \; i = 1, \ldots, N$.


$$
L(W) = \sum_{i, j = 1}^N \left(\|W_i - W_j\|^2_2 - D_{i,j}\right)^2 \to \min_{W \in \mathbb{R}^{N \times d}}
$$


–°—Å—ã–ª–∫–∞ –Ω–∞  –Ω–∞–≥–ª—è–¥–Ω—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é [$\clubsuit$](http://www.benfrederickson.com/numerical-optimization/), –≥–¥–µ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ –º–µ—Ç–æ–¥—ã –±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —ç—Ç—É –∑–∞–¥–∞—á—É –Ω–∞–º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞—Ö –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏.

:::{.callout-question}
–°–≤—è–∑–∞–Ω–æ –ª–∏ —ç—Ç–æ —Å PCA?
:::

## –ü—Ä–∏–º–µ—Ä: –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

![[–°—Å—ã–ª–∫–∞ –Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—é](https://fmin.xyz/docs/visualizations/mds.mp4)](mds.png){width=40%}

## –ü—Ä–∏–º–µ—Ä: –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Å–ø—É—Å–∫ –±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞

:::: {.columns}
::: {.column width="50%"}
–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º —Ä–µ—à–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É:

$$
L(w) \to \min_{w \in \mathbb{R}^d}
$$


—Å –ø–æ–º–æ—â—å—é –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Å–ø—É—Å–∫–∞ (GD):

$$
w_{k+1} = w_k - \alpha_k \nabla_w L(w_k)
$$


–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å $\nabla_w L(w_k)$ –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω—É–ª–µ–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞? 


–î–∞, –Ω–æ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Ü–µ–Ω—É.


–ú–æ–∂–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ü–µ–Ω–∫—É 2-—Ç–æ—á–µ—á–Ω–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞^[–ø—Ä–µ–¥–ª–∞–≥–∞—é [—Ö–æ—Ä–æ—à—É—é](https://scholar.harvard.edu/files/yujietang/files/slides_2019_zero-order_opt_tutorial.pdf) –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –æ –º–µ—Ç–æ–¥–∞—Ö –±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞] $G$:

$$
G = d\dfrac{L(w + \varepsilon v)- L(w - \varepsilon v)}{2 \varepsilon}v, 
$$

–≥–¥–µ $v$ —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–∏ —Å–∏–º–º–µ—Ç—Ä–∏—á–µ–Ω.
:::


::: {.column width="50%"}
!["–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –¥–≤—É—Ö—Ç–æ—á–µ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Å–ø—É—Å–∫–∞"](zgd_2p.pdf)
:::

::::


## –ü—Ä–∏–º–µ—Ä: –∫–æ–Ω–µ—á–Ω—ã–µ —Ä–∞–∑–Ω–æ—Å—Ç–∏

:::: {.columns}
::: {.column width="50%"}

$$
w_{k+1} = w_k - \alpha_k G
$$

 
–ú–æ–∂–µ–º —Ç–∞–∫–∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏–¥–µ—é –∫–æ–Ω–µ—á–Ω—ã—Ö —Ä–∞–∑–Ω–æ—Å—Ç–µ–π:

$$
G =  \sum\limits_{i=1}^d\dfrac{L(w+\varepsilon e_i) - L(w-\varepsilon e_i)}{2\varepsilon} e_i
$$

[–û—Ç–∫—Ä—ã—Ç—å –≤ Colab $\clubsuit$](https://colab.research.google.com/github/MerkulovDaniil/optim/blob/master/assets/Notebooks/Zero_order_GD.ipynb)

:::

::: {.column width="50%"}
!["–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ—Ü–µ–Ω–∫–∏ –∫–æ–Ω–µ—á–Ω—ã—Ö —Ä–∞–∑–Ω–æ—Å—Ç–µ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Å–ø—É—Å–∫–∞"](zgd_fd.pdf)
:::

::::

## –ü—Ä–æ–∫–ª—è—Ç–∏–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ –Ω—É–ª–µ–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ ^[[–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è –Ω—É–ª–µ–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø—É–∫–ª–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: —Å–∏–ª–∞ –¥–≤—É—Ö –æ—Ü–µ–Ω–æ–∫ —Ñ—É–Ω–∫—Ü–∏–∏](https://arxiv.org/pdf/1312.2139)]

$$
\min_{x \in \mathbb{R}^n} f(x)
$$


$$
\text{GD: } x_{k+1} = x_k - \alpha_k \nabla f(x_k) \qquad \qquad \text{Zero order GD: } x_{k+1} = x_k - \alpha_k G,
$$

–≥–¥–µ $G$ - –æ—Ü–µ–Ω–∫–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ 2-—Ç–æ—á–µ—á–Ω–∞—è –∏–ª–∏ –º–Ω–æ–≥–æ—Ç–æ—á–µ—á–Ω–∞—è.


|  | $f(x)$ - –≥–ª–∞–¥–∫–∞—è | $f(x)$ - –≥–ª–∞–¥–∫–∞—è –∏ –≤—ã–ø—É–∫–ª–∞—è | $f(x)$ - –≥–ª–∞–¥–∫–∞—è –∏ —Å–∏–ª—å–Ω–æ –≤—ã–ø—É–∫–ª–∞—è |
|:-:|:---:|:----:|:-------:|
| GD | $\|\nabla f(x_k)\|^2 \approx \mathcal{O} \left( \dfrac{1}{k} \right)$ | $f(x_k) - f^* \approx  \mathcal{O} \left( \dfrac{1}{k} \right)$ | $\|x_k - x^*\|^2 \approx \mathcal{O} \left( \left(1 - \dfrac{\mu}{L}\right)^k \right)$ |
| Zero order GD | $\|\nabla f(x_k)\|^2 \approx \mathcal{O} \left( \dfrac{n}{k} \right)$ | $f(x_k) - f^* \approx  \mathcal{O} \left( \dfrac{n}{k} \right)$ | $\|x_k - x^*\|^2 \approx \mathcal{O} \left( \left(1 - \dfrac{\mu}{n L}\right)^k \right)$ |

–î–ª—è 2-—Ç–æ—á–µ—á–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫, –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ª—É—á—à–µ, —á–µ–º –Ω–∞ $\sqrt{n}$ !


## –ö–æ–Ω–µ—á–Ω—ã–µ —Ä–∞–∑–Ω–æ—Å—Ç–∏

–ù–∞–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –ø–æ–ª—É—á–µ–Ω–∏—é –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ - —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ **–∫–æ–Ω–µ—á–Ω—ã—Ö —Ä–∞–∑–Ω–æ—Å—Ç–µ–π**. –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Å—Ç–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π:

$$
\dfrac{\partial L}{\partial w_k} (w) \approx \dfrac{L(w+\varepsilon e_k) - L(w)}{\varepsilon}, \quad e_k = (0, \ldots, \underset{{\tiny k}}{1}, \ldots, 0)
$$


:::{.callout-question}
–ï—Å–ª–∏ –≤—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –æ–¥–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è $L(w)$ —Ä–∞–≤–Ω–æ $T$, —Ç–æ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è $\nabla_w L$ —Å —ç—Ç–∏–º –ø–æ–¥—Ö–æ–¥–æ–º?


**–û—Ç–≤–µ—Ç** $2dT$, —á—Ç–æ –æ—á–µ–Ω—å –¥–æ–ª–≥–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∑–∞–¥–∞—á. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, —ç—Ç–æ—Ç —Ç–æ—á–Ω—ã–π –º–µ—Ç–æ–¥ –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –≤—ã–±–∏—Ä–∞—Ç—å –º–µ–∂–¥—É —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é.


**–¢–µ–æ—Ä–µ–º–∞**

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è $\nabla_w L$ –≤ $\mathcal{O}(T)$ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö. ^[Linnainmaa S. The representation of the cumulative rounding error of an algorithm as a Taylor expansion of the local rounding errors.  Master‚Äôs Thesis (in Finnish), Univ. Helsinki, 1970.]

:::

## –ü—Ä—è–º–æ–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è

–ß—Ç–æ–±—ã –≥–ª—É–±–∂–µ –ø–æ–Ω—è—Ç—å –∏–¥–µ—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Å—Ç—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö: 

$$
L(w_1, w_2) = w_2 \log w_1 + \sqrt{w_2 \log w_1}
$$


–î–∞–≤–∞–π—Ç–µ –Ω–∞—Ä–∏—Å—É–µ–º *–≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ* —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ $L(w_1, w_2)$](comp_graph.pdf)


–î–∞–≤–∞–π—Ç–µ –ø–æ–π–¥–µ–º –æ—Ç –Ω–∞—á–∞–ª–∞ –≥—Ä–∞—Ñ–∞ –∫ –∫–æ–Ω—Ü—É –∏ –≤—ã—á–∏—Å–ª–∏–º –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é $\dfrac{\partial L}{\partial w_1}$.

## –ü—Ä—è–º–æ–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è{.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](comp_graph1.pdf)

:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$w_1 = w_1, w_2 = w_2$
:::


::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\dfrac{\partial w_1}{\partial w_1} = 1, \dfrac{\partial w_2}{\partial w_1} = 0$ 
:::

::::




## –ü—Ä—è–º–æ–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è{.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](comp_graph2.pdf)



:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$v_1 = \log w_1$ 
:::



::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\frac{\partial v_1}{\partial w_1} = \frac{\partial v_1}{\partial w_1} \frac{\partial w_1}{\partial w_1} = \frac{1}{w_1} 1$
:::

::::

## –ü—Ä—è–º–æ–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è{.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](comp_graph3.pdf)



:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$v_2 = w_2 v_1$
:::



::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\frac{\partial v_2}{\partial w_1} = \frac{\partial v_2}{\partial v_1}\frac{\partial v_1}{\partial w_1} + \frac{\partial v_2}{\partial w_2}\frac{\partial w_2}{\partial w_1} = w_2\frac{\partial v_1}{\partial w_1} + v_1\frac{\partial w_2}{\partial w_1}$
:::

::::

## –ü—Ä—è–º–æ–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è{.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](comp_graph4.pdf)



:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$v_3 = \sqrt{v_2}$
:::



::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\frac{\partial v_3}{\partial w_1} = \frac{\partial v_3}{\partial v_2}\frac{\partial v_2}{\partial w_1} = \frac{1}{2\sqrt{v_2}}\frac{\partial v_2}{\partial w_1}$
:::

::::

## –ü—Ä—è–º–æ–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è{.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](comp_graph5.pdf)



:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$L = v_2 + v_3$ 
:::



::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\frac{\partial L}{\partial w_1} = \frac{\partial L}{\partial v_2}\frac{\partial v_2}{\partial w_1} + \frac{\partial L}{\partial v_3}\frac{\partial v_3}{\partial w_1} = 1\frac{\partial v_2}{\partial w_1} + 1\frac{\partial v_3}{\partial w_1}$
:::

::::

## –°–¥–µ–ª–∞–π—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–ª—è $\dfrac{\partial L}{\partial w_2}$

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ $L(w_1, w_2)$](comp_graph.pdf)


## –ü—Ä–∏–º–µ—Ä –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](cgraph_ex_1.pdf)

:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$w_1 = w_1, w_2 = w_2$
:::

::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\dfrac{\partial w_1}{\partial w_2} = 0, \dfrac{\partial w_2}{\partial w_2} = 1$
:::

::::

## –ü—Ä–∏–º–µ—Ä –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](cgraph_ex_2.pdf)

:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$v_1 = \log w_1$
:::

::: {.column width="50%"}
### Derivative

$\frac{\partial v_1}{\partial w_2} = \frac{\partial v_1}{\partial w_1} \frac{\partial w_1}{\partial w_2}= \frac{1}{w_1} \cdot 0$
:::

::::

## –ü—Ä–∏–º–µ—Ä –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](cgraph_ex_3.pdf)

:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$v_2 = w_2 v_1$
:::

::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\frac{\partial v_2}{\partial w_2} = \frac{\partial v_2}{\partial v_1}\frac{\partial v_1}{\partial w_2} + \frac{\partial v_2}{\partial w_2}\frac{\partial w_2}{\partial w_2} = w_2\frac{\partial v_1}{\partial w_2} + v_1\frac{\partial w_2}{\partial w_2}$ 
:::

::::

## –ü—Ä–∏–º–µ—Ä –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](cgraph_ex_4.pdf)

:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$v_3 = \sqrt{v_2}$
:::

::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\frac{\partial v_3}{\partial w_2} = \frac{\partial v_3}{\partial v_2}\frac{\partial v_2}{\partial w_2} = \frac{1}{2\sqrt{v_2}}\frac{\partial v_2}{\partial w_2}$
:::

::::

## –ü—Ä–∏–º–µ—Ä –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](cgraph_ex_5.pdf)

:::: {.columns}

::: {.column width="50%"}
### –§—É–Ω–∫—Ü–∏—è 

$L = v_2 + v_3$
:::

::: {.column width="50%"}
### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è

$\frac{\partial L}{\partial w_2} = \frac{\partial L}{\partial v_2}\frac{\partial v_2}{\partial w_2} + \frac{\partial L}{\partial v_3}\frac{\partial v_3}{\partial w_2} = 1\frac{\partial v_2}{\partial w_2} + 1\frac{\partial v_3}{\partial w_2}$
:::

::::

## –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è


:::: {.columns}

::: {.column width="50%"}

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ $v_i, i \in [1; N]$. –ù–∞—à–∞ —Ü–µ–ª—å - –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é –≤—ã—Ö–æ–¥–∞ —ç—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∞ –ø–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–π –≤—Ö–æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $w_k$, —Ç.–µ. $\dfrac{\partial v_N}{\partial w_k}$. –≠—Ç–∞ –∏–¥–µ—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –ø–æ –≤—Ö–æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Ç –Ω–∞—á–∞–ª–∞ –∫ –∫–æ–Ω—Ü—É, –ø–æ—ç—Ç–æ–º—É –º—ã –º–æ–∂–µ–º –≤–≤–µ—Å—Ç–∏ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ: 


$$
\overline{v_i} = \dfrac{\partial v_i}{\partial w_k}
$$

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](auto_diff_forward.pdf){width=80%}

:::


::: {.column width="50%"}

* –î–ª—è $i = 1, \ldots, N$:
    * –í—ã—á–∏—Å–ª–∏—Ç—å $v_i$ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é –µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª–µ–π (–≤—Ö–æ–¥–æ–≤) $x_1, \ldots, x_{t_i}$:
 $$
        v_i = v_i(x_1, \ldots, x_{t_i})
        $$
    * –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é $\overline{v_i}$ –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä—è–º–æ–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è:
 $$
        \overline{v_i} = \sum_{j = 1}^{t_i}\dfrac{\partial v_i}{\partial x_j}\dfrac{\partial x_j}{\partial w_k}
        $$


–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, –Ω–æ –º–æ–∂–Ω–æ –≤–∏–¥–µ—Ç—å, —á—Ç–æ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π $\dfrac{\partial L}{\partial w_k}$ –Ω–∞–º –Ω—É–∂–Ω–æ $\mathcal{O}(T)$ –æ–ø–µ—Ä–∞—Ü–∏–π. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–ª—è –≤—Å–µ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞, –Ω–∞–º –Ω—É–∂–Ω–æ $d\mathcal{O}(T)$ –æ–ø–µ—Ä–∞—Ü–∏–π, —á—Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö —Ä–∞–∑–Ω–æ—Å—Ç–µ–π, –Ω–æ —Ç–µ–ø–µ—Ä—å –º—ã –Ω–µ –∏–º–µ–µ–º –ø—Ä–æ–±–ª–µ–º —Å–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é, –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—è–º–∏(—Ñ–æ—Ä–º—É–ª—ã –≤—ã—à–µ —Ç–æ—á–Ω—ã).

:::

::::

## {.plain}
![](yoda.jpg)


## –û–±—Ä–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è

–ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç—É –∂–µ —Ñ—É–Ω–∫—Ü–∏—é —Å –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–º –≥—Ä–∞—Ñ–æ–º:

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ $L(w_1, w_2)$](comp_graph.pdf)



–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ $w_1, w_2$ –∏ –º—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –ø—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ (—Ç.–µ. –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ). –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º —Ç–∞–∫–∂–µ, —á—Ç–æ –º—ã –∫–∞–∫-—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –≤—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è $v_i$. –î–∞–≤–∞–π—Ç–µ –ø–æ–π–¥–µ–º –æ—Ç –∫–æ–Ω—Ü–∞ –≥—Ä–∞—Ñ–∞ –∫ –Ω–∞—á–∞–ª—É –∏ –≤—ã—á–∏—Å–ª–∏–º –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ $\dfrac{\partial L}{\partial w_1}, \dfrac{\partial L}{\partial w_2}$:

## –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](revad1.pdf)


### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ


$$
\dfrac{\partial L}{\partial L} = 1
$$

## –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](revad2.pdf)


### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ



$$
\begin{aligned}\frac{\partial L}{\partial v_3} &= \frac{\partial L}{\partial L} \frac{\partial L}{\partial v_3}\\ &= \frac{\partial L}{\partial L} 1\end{aligned}
$$ 

## –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](revad3.pdf)


### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ


$$
\begin{aligned}\frac{\partial L}{\partial v_2} &= \frac{\partial L}{\partial v_3}\frac{\partial v_3}{\partial v_2} + \frac{\partial L}{\partial L}\frac{\partial L}{\partial v_2} \\&= \frac{\partial L}{\partial v_3}\frac{1}{2\sqrt{v_2}} +  \frac{\partial L}{\partial L}1\end{aligned}
$$

## –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](revad4.pdf)


### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ


$$
\begin{aligned}\frac{\partial L}{\partial v_1} &=\frac{\partial L}{\partial v_2}\frac{\partial v_2}{\partial v_1} \\ &= \frac{\partial L}{\partial v_2}w_2\end{aligned}
$$

## –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è {.noframenumbering}

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](revad5.pdf)


### –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ


$$
\frac{\partial L}{\partial w_1} = \frac{\partial L}{\partial v_1}\frac{\partial v_1}{\partial w_1} = \frac{\partial L}{\partial v_1}\frac{1}{w_1} \qquad \qquad \frac{\partial L}{\partial w_2} = \frac{\partial L}{\partial v_2}\frac{\partial v_2}{\partial w_2} = \frac{\partial L}{\partial v_1}v_1
$$


## –û–±—Ä–∞—Ç–Ω—ã–π (reverse) —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è

:::{.callout-question}
–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, —á—Ç–æ –∏ –≤ –ø—Ä—è–º–æ–º —Ä–µ–∂–∏–º–µ, –º—ã –∏–º–µ–µ–º –ø–æ–ª–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ $\nabla_w L$. –≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –æ–±–µ–¥? –ö–∞–∫–æ–≤–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–∫–æ—Ä–µ–Ω–∏—è?


**–û—Ç–≤–µ—Ç** –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ AD –≤–∞–º –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–∑ –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞. –≠—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ —Å–º—è–≥—á–µ–Ω–∞ –ø–æ–¥—Ö–æ–¥–æ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ –±–æ–ª—å—à–æ–π –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
:::


## –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è


:::: {.columns}

::: {.column width="50%"}

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ $v_i, i \in [1; N]$. –ù–∞—à–∞ —Ü–µ–ª—å - –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é –≤—ã—Ö–æ–¥–∞ —ç—Ç–æ–≥–æ –≥—Ä–∞—Ñ–∞ –ø–æ –≤—Å–µ–º –≤—Ö–æ–¥–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º $w$, —Ç.–µ. $\nabla_w v_N =  \left( \frac{\partial v_N}{\partial w_1}, \ldots, \frac{\partial v_N}{\partial w_d}\right)^T$. –≠—Ç–∞ –∏–¥–µ—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ—Ç –∫–æ–Ω—Ü–∞ –∫ –Ω–∞—á–∞–ª—É, –ø–æ—ç—Ç–æ–º—É –º—ã –º–æ–∂–µ–º –≤–≤–µ—Å—Ç–∏ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ: 

$$
\overline{v_i}  = \dfrac{\partial L}{\partial v_i} = \dfrac{\partial v_N}{\partial v_i}
$$

![–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è](auto_diff_reverse.pdf){width=60%}

:::

::: {.column width="50%"}

* **–ü–†–Ø–ú–û–ô –ü–†–û–•–û–î** 

    –î–ª—è $i = 1, \ldots, N$:

    * –í—ã—á–∏—Å–ª–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è $v_i$ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é –µ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª–µ–π (–≤—Ö–æ–¥–æ–≤) 

* **–û–ë–†–ê–¢–ù–´–ô –ü–†–û–•–û–î**
    
    –î–ª—è $i = N, \ldots, 1$:

    * –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é $\overline{v_i}$ –∏—Å–ø–æ–ª—å–∑—É—è –æ–±—Ä–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ—Ç –≤—Å–µ—Ö –µ–≥–æ –¥–µ—Ç–µ–π (–≤—ã—Ö–æ–¥–æ–≤) ($x_1, \ldots, x_{t_i}$):
        $$
        \overline{v_i} = \dfrac{\partial L}{\partial v_i} = \sum_{j = 1}^{t_i} \dfrac{\partial L}{\partial x_j} \dfrac{\partial x_j}{\partial v_i}
        $$

:::

::::


## –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ–π—Ü–∞


:::: {.columns}

::: {.column width="40%"}

![–ö–∞–∫–æ–π —Ä–µ–∂–∏–º –≤—ã –±—ã –≤—ã–±—Ä–∞–ª–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤?](ad_choose.pdf)
:::

::: {.column width="60%"}
:::{.callout-question}
–ö–∞–∫–æ–π –∏–∑ —Ä–µ–∂–∏–º–æ–≤ AD –≤—ã –±—ã –≤—ã–±—Ä–∞–ª–∏ (–ø—Ä—è–º–æ–π/–æ–±—Ä–∞—Ç–Ω—ã–π) –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π? –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å —è–∫–æ–±–∏–∞–Ω $J = \left\{ \dfrac{\partial L_i}{\partial w_j} \right\}_{i,j}$
:::


**–û—Ç–≤–µ—Ç** –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤—Ä–µ–º—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤ –æ–±—Ä–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—ã—Ö–æ–¥–æ–≤, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –ø—Ä—è–º–æ–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤—Ö–æ–¥–æ–≤. –ü–æ—ç—Ç–æ–º—É –±—ã–ª–æ –±—ã —Ö–æ—Ä–æ—à–µ–π –∏–¥–µ–µ–π —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä—è–º–æ–π —Ä–µ–∂–∏–º AD. 

:::



::::

## –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ–π—Ü–∞

![ [$\clubsuit$](https://colab.research.google.com/github/MerkulovDaniil/optim/blob/master/assets/Notebooks/Autograd_and_Jax.ipynb) –≠—Ç–æ—Ç –≥—Ä–∞—Ñ —Ö–æ—Ä–æ—à–æ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏–¥–µ—é –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏. –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å $n = 100$ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞, –∏ –≥—Ä–∞—Ñ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —è–∫–æ–±–∏–∞–Ω–∞ w.r.t. $x$ –¥–ª—è $f(x) = Ax$](forward_vs_reverse_ad.pdf){width=88%}

## –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ–π—Ü–∞

:::: {.columns}

::: {.column width="40%"}

![–ö–∞–∫–æ–π —Ä–µ–∂–∏–º –≤—ã –±—ã –≤—ã–±—Ä–∞–ª–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤?](ad_mixed.pdf){width=60%}

:::

::: {.column width="60%"}
:::{.callout-question}
–ö–∞–∫–æ–π –∏–∑ —Ä–µ–∂–∏–º–æ–≤ AD –≤—ã –±—ã –≤—ã–±—Ä–∞–ª–∏ (–ø—Ä—è–º–æ–π/–æ–±—Ä–∞—Ç–Ω—ã–π) –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π? –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å —è–∫–æ–±–∏–∞–Ω $J = \left\{ \dfrac{\partial L_i}{\partial w_j} \right\}_{i,j}$. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ $G$ - —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ
:::

**–û—Ç–≤–µ—Ç** –í –æ–±—â–µ–º —Å–ª—É—á–∞–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å —ç—Ç–æ –±–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –∑–Ω–∞–Ω–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≥—Ä–∞—Ñ–∞ $G$. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Ç–∞–∫–∂–µ –µ—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ –¥–ª—è —Å–º–µ—à–∏–≤–∞–Ω–∏—è –ø—Ä—è–º–æ–≥–æ –∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–æ–≤ AD, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ $G$.

:::


::::

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä—è–º–æ–≥–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è

:::: {.columns}

::: {.column width="40%"}

**–ü–†–Ø–ú–û–ô –ü–†–û–•–û–î**

* $v_0 = x$ –æ–±—ã—á–Ω–æ —É –Ω–∞—Å –µ—Å—Ç—å batch –¥–∞–Ω–Ω—ã—Ö $x$ –∑–¥–µ—Å—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤—Ö–æ–¥–∞.
* –î–ª—è $k = 1, \ldots, t-1, t$: 
    
    * $v_k = \sigma(v_{k-1}w_k)$. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≥–æ–≤–æ—Ä—è, –¥–∞–Ω–Ω—ã–µ –∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å $x  \in \mathbb{R}^{b \times d}$, –≥–¥–µ $b$ - —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–∞–Ω–Ω–æ–≥–æ $b=1$). –í —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –º–∞—Ç—Ä–∏—Ü–∞ –≤–µ—Å–æ–≤ $w_k$ $k$ —Å–ª–æ—è –∏–º–µ–µ—Ç —Ä–∞–∑–º–µ—Ä $n_{k-1} \times n_k$, –≥–¥–µ $n_k$ - —Ä–∞–∑–º–µ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. 

* $L = L(v_t)$ - –≤—ã—á–∏—Å–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Ç–µ—Ä—å.

**–û–ë–†–ê–¢–ù–´–ô –ü–†–û–•–û–î**

* $v_{t+1} = L, \dfrac{\partial L}{\partial L} = 1$
* –î–ª—è $k = t, t-1, \ldots, 1$: 
    
    * $\underset{b \times n_k}{\dfrac{\partial L}{\partial v_k}} = \underset{b \times n_{k+1}}{\dfrac{\partial L}{\partial v_{k+1}}} \underset{n_{k+1} \times n_k}{\dfrac{\partial v_{k+1}}{\partial v_{k}}}$
    * $\underset{b \times n_{k-1} \cdot n_k}{\dfrac{\partial L}{\partial w_k}} = \underset{b \times n_{k+1}}{\dfrac{\partial L}{\partial v_{k+1}}} \cdot  \underset{n_{k+1} \times n_{k-1} \cdot n_k}{\dfrac{\partial v_{k+1}}{\partial w_{k}}}$


:::

::: {.column width="60%"}

![–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä—è–º–æ–≥–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏](feedforward.pdf)

:::

::::

## –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ì–µ—Å—Å–∏–∞–Ω–∞ –Ω–∞ –≤–µ–∫—Ç–æ—Ä –±–µ–∑ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–∞–º–æ–≥–æ –ì–µ—Å—Å–∏–∞–Ω–∞



–ö–æ–≥–¥–∞ –≤–∞–º –Ω—É–∂–Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—Ä–∏–≤–∏–∑–Ω–µ —Ñ—É–Ω–∫—Ü–∏–∏, –æ–±—ã—á–Ω–æ –≤–∞–º –Ω—É–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≥–µ—Å—Å–∏–∞–Ω–æ–º. –û–¥–Ω–∞–∫–æ, –∫–æ–≥–¥–∞ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á–∏ –≤–µ–ª–∏–∫–∞, —ç—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –≤—ã–∑–æ–≤–æ–º. –î–ª—è —Å–∫–∞–ª—è—Ä–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ $f : \mathbb{R}^n \to \mathbb{R}$, –≥–µ—Å—Å–∏–∞–Ω –≤ —Ç–æ—á–∫–µ $x \in \mathbb{R}^n$ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ $\nabla^2 f(x)$. –¢–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–∞ –Ω–∞ –≥–µ—Å—Å–∏–∞–Ω –º–æ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å


$$
v \mapsto \nabla^2 f(x) \cdot v
$$


–¥–ª—è –ª—é–±–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞ $v \in \mathbb{R}^n$. –ú—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∂–¥–µ—Å—Ç–≤–æ
$$
\nabla^2 f (x) v = \nabla [x \mapsto \nabla f(x) \cdot v] = \nabla g(x),
$$
–≥–¥–µ $g(x) = \nabla f(x)^T \cdot v$ - –Ω–æ–≤–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —É–º–Ω–æ–∂–∞–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç $f$ –≤ $x$ –Ω–∞ –≤–µ–∫—Ç–æ—Ä $v$.


```python
import jax.numpy as jnp

def hvp(f, x, v):
    return grad(lambda x: jnp.vdot(grad(f)(x), v))(x)
```

## –î–∏–Ω–∞–º–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ —Å–ø–µ–∫—Ç—Ä –ì–µ—Å—Å–∏–∞–Ω–∞ –∏ hvp ^[[–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π —á–µ—Ä–µ–∑ —Å–ø–µ–∫—Ç—Ä —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ì–µ—Å—Å–∏–∞–Ω–∞](https://arxiv.org/abs/1901.10159)]

![–ë–æ–ª—å—à–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏—Å—á–µ–∑–ª–∏ –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è ResNet-32](ResNet_32_before_After.png)

## –ò–¥–µ—è –•–∞–¥—á–∏–Ω—Å–æ–Ω–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–ª–µ–¥–∞ –º–∞—Ç—Ä–∏—Ü—ã  ^[[A stochastic estimator of the trace of the influence matrix for Laplacian smoothing splines - M.F. Hutchinson, 1990](https://www.tandfonline.com/doi/abs/10.1080/03610919008812866)]

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ—Ü–µ–Ω–∫—É —Å–ª–µ–¥–∞ –ì–µ—Å—Å–∏–∞–Ω–∞ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ Hutchinson, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–∞–∫–æ–π –æ—Ü–µ–Ω–∫–∏ –∏–∑ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π –º–∞—Ç—Ä–∏—Ü—ã –Ω–∞ –≤–µ–∫—Ç–æ—Ä:

–ü—É—Å—Ç—å $X \in \mathbb{R}^{d \times d}$ –∏ $v \in \mathbb{R}^d$ - —Å–ª—É—á–∞–π–Ω—ã–π –≤–µ–∫—Ç–æ—Ä —Ç–∞–∫–æ–π, —á—Ç–æ $\mathbb{E}[vv^T] = I$. –¢–æ–≥–¥–∞,

:::: {.columns}
::: {.column width="30%"}

$$
\mathrm{Tr}(X) = \mathbb{E}[v^TXv] = \frac{1}{V}\sum_{i=1}^{V}v_i^TXv_i.
$$

:::
::: {.column width="70%"}
![[–ò—Å—Ç–æ—á–Ω–∏–∫](https://docs.backpack.pt/en/master/use_cases/example_trace_estimation.html)](Hutchinson_trace_est.pdf)
:::
::::


## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–π

–ê–Ω–∏–º–∞—Ü–∏—è –≤—ã—à–µ—É–∫–∞–∑–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ [\faGithub](https://github.com/cybertronai/gradient-checkpointing)

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ [\faGithub](https://colab.research.google.com/github/oseledets/dl2023/blob/main/seminars/seminar-10/Large_model_training_practice.ipynb)


–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ **GPT-2**^[[ZeRO: Memory Optimizations Toward Training Trillion Parameter Models](https://arxiv.org/abs/1910.02054)]: 

   * –ê–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤ –ø—Ä–æ—Å—Ç–æ–º —Ä–µ–∂–∏–º–µ –º–æ–≥—É—Ç –∑–∞–Ω–∏–º–∞—Ç—å –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏: –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª–∏–Ω–æ–π 1K –∏ —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞ $32$, $60$ GB –Ω—É–∂–Ω–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –∞–∫—Ç–∏–≤–∞—Ü–∏–π. 
   * –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–π –º–æ–≥—É—Ç —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–æ 8 GB, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–≤ –∏—Ö (33% –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π) 


## –ß–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ (AD) –Ω–µ —è–≤–ª—è–µ—Ç—Å—è:

:::: {.columns}

::: {.column width="40%"}

* AD –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω–µ—á–Ω—ã–º–∏ —Ä–∞–∑–Ω–æ—Å—Ç—è–º–∏
* AD –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π
* AD –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ü–µ–ø–Ω—ã–º –ø—Ä–∞–≤–∏–ª–æ–º
* AD –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞—Ç–Ω—ã–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ–º
* AD (–æ–±—Ä–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º) —è–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º—è—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏ —á–∏—Å–ª–µ–Ω–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º
* AD (–æ–±—Ä–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º) —è–≤–ª—è–µ—Ç—Å—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –≤ –ø–∞–º—è—Ç–∏ (–≤–∞–º –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–∑ –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞). 

:::

::: {.column width="60%"}

![–†–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –≤–∑—è—Ç–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö](differentiation_scheme.pdf)

:::

::::

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

* –Ø —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ—á–∏—Ç–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –∫–Ω–∏–≥—É –ø–æ Jax Autodiff. [Open In Colab $\clubsuit$](https://colab.research.google.com/github/MerkulovDaniil/optim/blob/master/assets/Notebooks/Autograd_and_Jax.ipynb)
* –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ –ª–∏–Ω–µ–π–Ω—ã–µ –Ω–∞–∏–º–µ–Ω—å—à–∏–µ –∫–≤–∞–¥—Ä–∞—Ç—ã [—Å–µ–º–∏–Ω–∞—Ä]
* –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ SVD [—Å–µ–º–∏–Ω–∞—Ä]
* –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–π [—Å–µ–º–∏–Ω–∞—Ä]

# –ò—Ç–æ–≥–∏

## –ò—Ç–æ–≥–∏

:::: {.columns .nonincremental}

::: {.column width="50%"}

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

1. –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ $f(x): \mathbb{R}^n \to \mathbb{R}$ –ø–æ $k$-–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–µ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ –∫–æ–Ω–µ—á–Ω—ã—Ö —Ä–∞–∑–Ω–æ—Å—Ç–µ–π.
1. –ü—É—Å—Ç—å $f = f(x_1(t), \ldots, x_n(t))$. –§–æ—Ä–º—É–ª–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è $\frac{\partial f}{\partial t}$ —á–µ—Ä–µ–∑ $\frac{\partial x_i}{\partial t}$ (Forward chain rule).
1. –ü—É—Å—Ç—å $L$ - —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è —Å–∫–∞–ª—è—Ä, –∞ $v_k$ - —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –≤–µ–∫—Ç–æ—Ä $x \in \mathbb{R}^t$. –§–æ—Ä–º—É–ª–∞ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è $\frac{\partial L}{\partial v_k}$ —á–µ—Ä–µ–∑ $\frac{\partial L}{\partial x_i}$ (Backward chain rule).
1. –ò–¥–µ—è –•–∞—Ç—á–∏–Ω—Å–æ–Ω–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–ª–µ–¥–∞ –º–∞—Ç—Ä–∏—Ü—ã —Å –ø–æ–º–æ—â—å—é matvec –æ–ø–µ—Ä–∞—Ü–∏–π.

:::

::: {.column width="50%"}

### –¢–µ–æ—Ä–µ–º—ã

1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ. –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ. Forward/ Backward mode (–≤ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ –Ω–µ—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤, –Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º—ã).

:::
# –ó–∞–¥–∞—á–∏ 

## –ó–∞–¥–∞—á–∞ 1

::: {.callout-question}
–ö–∞–∫–æ–π –∏–∑ —Ä–µ–∂–∏–º–æ–≤ AD –≤—ã –±—ã –≤—ã–±—Ä–∞–ª–∏ (–ø—Ä—è–º–æ–π/–æ–±—Ä–∞—Ç–Ω—ã–π) –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π?
:::

![–ö–∞–∫–æ–π —Ä–µ–∂–∏–º –≤—ã –±—ã –≤—ã–±—Ä–∞–ª–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤?](ad_choose.pdf){width=175}

## –ó–∞–¥–∞—á–∞ 2

:::: {.columns}

::: {.column width="50%"}

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –æ–±—Ä–∞—Ç–∏–º–∞—è –º–∞—Ç—Ä–∏—Ü–∞ $A$ –∏ –≤–µ–∫—Ç–æ—Ä $b$, –≤–µ–∫—Ç–æ—Ä $x$ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã –ª–∏–Ω–µ–π–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π $Ax = b$, —Ç–æ –µ—Å—Ç—å –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ $x = A^{-1}b$.


\
\

::: {.callout-question}

–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ $\dfrac{\partial L}{\partial A}, \dfrac{\partial L}{\partial b}$.

:::

:::

::: {.column width="50%"}

![$x$ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–π–¥–µ–Ω –∫–∞–∫ —Ä–µ—à–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã](linear_least_squares_layer.pdf){width=200}

:::
## –ó–∞–¥–∞—á–∞ 3

:::: {.columns}

::: {.column width="50%"}

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ $W \in \mathbb{R}^{m \times n}$, –∫–æ—Ç–æ—Ä–∞—è –∏–º–µ–µ—Ç —Å–∏–Ω–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ:

\
\

$$
W = U \Sigma V^T, \quad U^TU = I, \quad V^TV = I,
$$ 
$$
\Sigma = \text{diag}(\sigma_1, \ldots, \sigma_{\min(m,n)})
$$

\
\
–†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ç–æ—Ä $R(W) = \text{tr}(\Sigma)$ –≤ –ª—é–±–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –Ω–∏–∑–∫–æ—Ä–∞–Ω–≥–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è. 

::: {.callout-question}

–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é $\dfrac{\partial R}{\partial W}$.

:::
:::

::: {.column width="50%"}

![–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ –¥–ª—è —Å–∏–Ω–≥—É–ª—è—Ä–Ω–æ–≥–æ —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ç–æ—Ä–∞](svd_singular_regularizer_comp_graph.pdf){width=200}

:::
# –ó–∞–¥–∞—á–∏ –Ω–∞ –¥–æ–º 

1. **–ë–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ì–µ—Å—Å–∏–∞–Ω–∞ –Ω–∞ –≤–µ–∫—Ç–æ—Ä (HVP) –≤ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏ —á–µ—Ä–µ–∑ JAX** [22 –±–∞–ª–ª–∞]

    –í–∞–º –¥–∞–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –Ω–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å (MLP —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–∫—Ä—ã—Ç—ã–º–∏ —Å–ª–æ—è–º–∏ —Å –Ω–µ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å—é, —Ç–∞–∫–æ–π –∫–∞–∫ GELU). –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤–µ—Å–∞–º–∏ –µ–µ —Å–ª–æ–µ–≤. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã —Å—Ä–∞–≤–Ω–∏—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ì–µ—Å—Å–∏–∞–Ω–∞ –Ω–∞ –≤–µ–∫—Ç–æ—Ä (HVP) –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å –º–æ–¥–µ–ª–∏ –∏ –∏–∑—É—á–∏—Ç—å, –∫–∞–∫ –≤—Ä–µ–º—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è —Å —Ä–æ—Å—Ç–æ–º –º–æ–¥–µ–ª–∏.

    **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å:** [2/22 –±–∞–ª–ª–∞] –í–æ—Ç –∫–æ–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å. –ù–∞–ø–∏—à–∏—Ç–µ –º–µ—Ç–æ–¥ `get_params()`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≥–ª–∞–∂–µ–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –≤—Å–µ—Ö –≤–µ—Å–æ–≤ –º–æ–¥–µ–ª–∏.

    ```python
    import jax
    import jax.numpy as jnp
    import time
    import matplotlib.pyplot as plt
    import numpy as np
    import pandas as pd
    from tqdm.auto import tqdm
    from jax.nn import gelu

    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ MLP –º–æ–¥–µ–ª–∏
    class MLP:
        def __init__(self, key, layer_sizes):
            self.layer_sizes = layer_sizes
            keys = jax.random.split(key, len(layer_sizes) - 1)
            self.weights = [
                jax.random.normal(k, (layer_sizes[i], layer_sizes[i + 1]))
                for i, k in enumerate(keys)
                ]
        
        def forward(self, x):
            for w in self.weights[:-1]:
                x = gelu(jnp.dot(x, w))
            return jnp.dot(x, self.weights[-1])
        
        def get_params(self):
            ### YOUR CODE HERE ###
            return None
    ```

    **Hessian and HVP Implementations:** [2/22 points] Write a function 
    
    ```python
    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ì–µ—Å—Å–∏–∞–Ω–∞
    def calculate_hessian(model, params):
        def loss_fn(p):
            x = jnp.ones((1, model.layer_sizes[0]))  # –ó–∞–≥–ª—É—à–∫–∞ –≤—Ö–æ–¥–∞
            return jnp.sum(model.forward(x))
        
        ### YOUR CODE HERE ###
        #hessian_fn =           
        return hessian_fn(params)
    ```
    –∫–æ—Ç–æ—Ä—ã–π –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –ì–µ—Å—Å–∏–∞–Ω $H$ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –º–æ–¥–µ–ª–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è JAX.
    
    **Naive HVP —á–µ—Ä–µ–∑ –ø–æ–ª–Ω—ã–π –ì–µ—Å—Å–∏–∞–Ω:** [2/22 –±–∞–ª–ª–∞] –ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é ```naive_hvp(hessian, vector)```, –∫–æ—Ç–æ—Ä–∞—è, —É—á–∏—Ç—ã–≤–∞—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –ì–µ—Å—Å–∏–∞–Ω $H$ –∏ –≤–µ–∫—Ç–æ—Ä $v$ (—Ç–æ–π –∂–µ —Ñ–æ—Ä–º—ã, —á—Ç–æ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã), –≤—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ì–µ—Å—Å–∏–∞–Ω–∞ –Ω–∞ –≤–µ–∫—Ç–æ—Ä —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä—è–º–æ–≥–æ –º–∞—Ç—Ä–∏—á–Ω–æ-–≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è.

    **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ HVP —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Autograd:** [4/22 –±–∞–ª–ª–∞] –ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é 
    ```python
     def hvp(f, x, v):
         return jax.grad(lambda x: jnp.vdot(jax.grad(f)(x), v))(x)
    ```
    –∫–æ—Ç–æ—Ä–∞—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã—á–∏—Å–ª—è–µ—Ç HVP –±–µ–∑ —è–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –ì–µ—Å—Å–∏–∞–Ω–∞. –≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è JAX.
     
    **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏:** –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å–µ–º–µ–π—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–º—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–∫—Ä—ã—Ç—ã—Ö —Å–ª–æ–µ–≤. 

    ```python
    ns = np.linspace(50, 1000, 15, dtype=int)  # The number of hidden layers
    num_runs = 10  # The number of runs for averaging
    ```

    –î–ª—è –∫–∞–∂–¥–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏:
    * –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –º–æ–¥–µ–ª—å –∏ –∏–∑–≤–ª–µ–∫–∏—Ç–µ –µ–µ –≤–µ–∫—Ç–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
    * –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π –≤–µ–∫—Ç–æ—Ä $v$ —Ç–æ–π –∂–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏, —á—Ç–æ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
    * –ò–∑–º–µ—Ä—å—Ç–µ (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ```.block_until_ready()``` –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏) —Å–ª–µ–¥—É—é—â–µ–µ:
       1. **–û–±—â–µ–µ –≤—Ä–µ–º—è (–ø–æ–ª–Ω—ã–π –ì–µ—Å—Å–∏–∞–Ω + Naive HVP):** –û–±—â–µ–µ –≤—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –ì–µ—Å—Å–∏–∞–Ω–∞ –∏ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞—Ç—Ä–∏—á–Ω–æ-–≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è.
       2. **–í—Ä–µ–º—è Naive HVP (–±–µ–∑ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ì–µ—Å—Å–∏–∞–Ω–∞):** –í—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞—Ç—Ä–∏—á–Ω–æ-–≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è, —É—á–∏—Ç—ã–≤–∞—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –ì–µ—Å—Å–∏–∞–Ω.
       3. **–í—Ä–µ–º—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ HVP:** –í—Ä–µ–º—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è HVP —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ autograd.
    * –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—É—Å–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10 –∑–∞–ø—É—Å–∫–æ–≤) –∏ –∑–∞–ø–∏—à–∏—Ç–µ –∫–∞–∫ —Å—Ä–µ–¥–Ω–µ–µ, —Ç–∞–∫ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è. 
    
    **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏–∑:** [12/22 –±–∞–ª–ª–∞]
    * –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Ç—Ä–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º –≥—Ä–∞—Ñ–∏–∫–µ. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç–µ –æ—à–∏–±–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—é –ø–æ –∑–∞–ø—É—Å–∫–∞–º.
    * –ß–µ—Ç–∫–æ –æ–±–æ–∑–Ω–∞—á—å—Ç–µ –æ—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–µ–≤" –ø—Ä–æ—Ç–∏–≤ "–í—Ä–µ–º—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)") –∏ –≤–∫–ª—é—á–∏—Ç–µ –ª–µ–≥–µ–Ω–¥—É, —É–∫–∞–∑—ã–≤–∞—é—â—É—é, –∫–∞–∫–∞—è –∫—Ä–∏–≤–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–∞–∫–æ–º—É –º–µ—Ç–æ–¥—É.
    * –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–µ—Å—Ç–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å –µ–≥–æ —Å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.

1. [15 –±–∞–ª–ª–æ–≤] –ú—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤, –Ω–æ –∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, —Ç–∞–∫–∏—Ö –∫–∞–∫ —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –≤ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–º —Å–ø—É—Å–∫–µ (—Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–º —Å–ø—É—Å–∫–æ–º ü§Ø). –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è $f(x) = \frac{1}{2}\Vert x\Vert^2$, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é —Ç–æ—á–∫—É $x_0 \in \mathbb{B}^{1000} = \{0 \leq x_i \leq 1 \mid \forall i\}$. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º $10$ —à–∞–≥–æ–≤ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Å–ø—É—Å–∫–∞, –Ω–∞—á–∏–Ω–∞—è —Å —Ç–æ—á–∫–∏ $x_0$:
    $$
    x_{k+1} = x_k - \alpha_k \nabla f(x_k)
    $$
    –í–∞—à–∞ —Ü–µ–ª—å –≤ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç $10$ —Å–∫–∞–ª—è—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π $\alpha_i$ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Å–ø—É—Å–∫–∞ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ $L = f(x_{10})$. –ò –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é —Å –ø–æ–º–æ—â—å—é –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Å–ø—É—Å–∫–∞ –Ω–∞ $\alpha \in \mathbb{R}^{10}$. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –∫–∞–∂–¥—ã–π –∏–∑ $10$ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ $\alpha$ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω –Ω–∞ $[0; 0.1]$.
    $$
    \alpha_{k+1} = \alpha_k - \beta \frac{\partial L}{\partial \alpha}
    $$
    –í—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É $\beta$ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –≤–∞–º –Ω—É–∂–Ω–æ. –û–ø–∏—à–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ö–∞–∫ –≤—ã –ø–æ–π–º–µ—Ç–µ, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ ($\alpha \in \mathbb{R}^{10}$) —Å—Ç–∞–ª –ª—É—á—à–µ, —á–µ–º –±—ã–ª –≤ –Ω–∞—á–∞–ª–µ? –ö–∞–∫ –≤—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—É—é –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç—å —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ —á–∏—Å–ª–µ–Ω–Ω–æ? 

::::